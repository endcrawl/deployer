#!/bin/sh
# Runs a command in the current environment minus all GIT_* variables.
{

  # First, output NAME=VALUE environment pairs separated by null chars.
  # Strip out any pairs where NAME starts with "GIT_".

  env -0 | sed -Ee '
    s/(^|\x0)GIT_[^\x0]*=[^\x0]*(\x0|$)/\1\2/g;
    s/\x0\x0+/\x0/g;
    s/^\x0+//;
    s/\x0+$//;
  '

  # Now emit the argv separated by null chars.

  printf "\0"
  for a in "$@"; do
    printf "%s\0" "$a"
  done |
  sed -Ee 's/\x0+$//'

} |
# Reconstruct a full env(1) command line and run it.
xargs -0 env -

